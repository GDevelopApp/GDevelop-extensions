{
  "author": "",
  "category": "",
  "extensionNamespace": "",
  "fullName": "3D sprite",
  "helpPath": "",
  "iconUrl": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0ibWRpLWdob3N0LW91dGxpbmUiIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTIgMkM3LjAzIDIgMyA2LjAzIDMgMTFWMjJMNiAxOUw5IDIyTDEyIDE5TDE1IDIyTDE4IDE5TDIxIDIyVjExQzIxIDYuMDMgMTYuOTcgMiAxMiAyTTE5IDE3LjE3TDE4IDE2LjE3TDE2LjU5IDE3LjU5TDE1IDE5LjE3TDEzLjQxIDE3LjU5TDEyIDE2LjE3TDEwLjU5IDE3LjU5TDkgMTkuMTdMNy40MSAxNy41OUw2IDE2LjE3TDUgMTcuMTdWMTFDNSA3LjE0IDguMTQgNCAxMiA0UzE5IDcuMTQgMTkgMTFWMTcuMTdNMTEgMTBDMTEgMTEuMTEgMTAuMTEgMTIgOSAxMlM3IDExLjExIDcgMTAgNy45IDggOSA4IDExIDguOSAxMSAxME0xNyAxMEMxNyAxMS4xMSAxNi4xMSAxMiAxNSAxMlMxMyAxMS4xMSAxMyAxMCAxMy45IDggMTUgOCAxNyA4LjkgMTcgMTBaIiAvPjwvc3ZnPg==",
  "name": "Sprite3D",
  "previewIconUrl": "https://asset-resources.gdevelop.io/public-resources/Icons/3bd33ec77ed20d3f631c6c92884728b375aa2879174bc9f289c864d0e0383d59_ghost-outline.svg",
  "shortDescription": "An animated sprite in 3D.",
  "version": "0.1.0",
  "description": "",
  "tags": [],
  "authorIds": [
    "IWykYNRvhCZBN3vEgKEbBPOR3Oc2"
  ],
  "dependencies": [],
  "eventsFunctions": [
    {
      "description": "Define helper classes JavaScript code.",
      "fullName": "Define helper classes",
      "functionType": "Action",
      "name": "DefineHelperClasses",
      "private": true,
      "sentence": "Define helper classes JavaScript code",
      "events": [
        {
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": [
            "if (gdjs.__sprite3DExtension) {",
            "    return;",
            "}",
            "",
            "class Sprite3DRenderer {",
            "    /** @type {gdjs.CustomRuntimeObject} */",
            "    object;",
            "    /** @type {THREE.Mesh} */",
            "    mesh;",
            "",
            "    /**",
            "     * @param object {gdjs.CustomRuntimeObject}",
            "     */",
            "    constructor(object) {",
            "        this.object = object;",
            "",
            "        const imageManager = object",
            "            .getInstanceContainer()",
            "            .getGame()",
            "            .getImageManager();",
            "        const resourceName = object.getAnimator().getCurrentFrame().image;",
            "        const material = imageManager.getThreeMaterial(resourceName, {",
            "            useTransparentTexture: true,",
            "            forceBasicMaterial: true,",
            "        })",
            "        const geometry = new THREE.PlaneGeometry(1, -1);",
            "        this.mesh = new THREE.Mesh(geometry, material);",
            "        this.mesh.rotation.order = 'ZYX';",
            "        object.get3DRendererObject().add(this.mesh);",
            "",
            "        this.updateFrame();",
            "        object.getAnimator().setOnFrameChangeCallback(() => this.updateFrame());",
            "    }",
            "",
            "    updateFrame() {",
            "        const imageManager = this.object",
            "            .getInstanceContainer()",
            "            .getGame()",
            "            .getImageManager();",
            "        const frame = this.object.getAnimator().getCurrentFrame();",
            "",
            "        const image = imageManager.getThreeTexture(frame.image).image;",
            "        const width = image.width;",
            "        const height = image.height;",
            "        const origin = frame.originPoint;",
            "        this.mesh.position.set(-origin.x + width / 2, -origin.y + height / 2, 0);",
            "        this.mesh.scale.set(width, height, 1);",
            "",
            "        if (frame.centerPoint.automatic) {",
            "            this.object.setRotationCenter(width / 2 - origin.x, height / 2 - origin.y);",
            "        }",
            "        else {",
            "            this.object.setRotationCenter(frame.centerPoint.x - origin.x, frame.centerPoint.y - origin.y);",
            "        }",
            "",
            "        this.mesh.material = imageManager.getThreeMaterial(frame.image, {",
            "            useTransparentTexture: true,",
            "            forceBasicMaterial: true,",
            "        });",
            "",
            "        const hitBoxes = this.object._untransformedHitBoxes;",
            "        if (frame.hasCustomCollisionMask) {",
            "            let i = 0;",
            "            for (let len = frame.customCollisionMask.length; i < len; ++i) {",
            "                const polygonData = frame.customCollisionMask[i];",
            "",
            "                // Add a polygon, if necessary (Avoid recreating a polygon if it already exists).",
            "                if (i >= hitBoxes.length) {",
            "                    hitBoxes.push(new gdjs.Polygon());",
            "                }",
            "                let j = 0;",
            "                for (const len2 = polygonData.length; j < len2; ++j) {",
            "                    const pointData = polygonData[j];",
            "",
            "                    // Add a point, if necessary (Avoid recreating a point if it already exists).",
            "                    if (j >= hitBoxes[i].vertices.length) {",
            "                        hitBoxes[i].vertices.push([0, 0]);",
            "                    }",
            "                    hitBoxes[i].vertices[j][0] = pointData.x - origin.x;",
            "                    hitBoxes[i].vertices[j][1] = pointData.y - origin.y;",
            "                }",
            "                hitBoxes[i].vertices.length = j;",
            "            }",
            "            hitBoxes.length = i;",
            "        }",
            "        else if (hitBoxes.length === 0) {",
            "            const hitBox = new gdjs.Polygon();",
            "            hitBoxes.push(hitBox);",
            "            const vertices = hitBox.vertices;",
            "            vertices.push([-origin.x, -origin.y]);",
            "            vertices.push([-origin.x + width, -origin.y]);",
            "            vertices.push([-origin.x + width, -origin.y + height]);",
            "            vertices.push([-origin.x, -origin.y + height]);",
            "        }",
            "        ",
            "        const aabb = this.object._unrotatedAABB;",
            "        let first = true;",
            "        for (let i = 0; i < hitBoxes.length; i++) {",
            "          for (let j = 0; j < hitBoxes[i].vertices.length; j++) {",
            "            const vertex = hitBoxes[i].vertices[j];",
            "            if (first) {",
            "              aabb.min[0] = vertex[0];",
            "              aabb.max[0] = vertex[0];",
            "              aabb.min[1] = vertex[1];",
            "              aabb.max[1] = vertex[1];",
            "              first = false;",
            "            } else {",
            "              aabb.min[0] = Math.min(aabb.min[0], vertex[0]);",
            "              aabb.max[0] = Math.max(aabb.max[0], vertex[0]);",
            "              aabb.min[1] = Math.min(aabb.min[1], vertex[1]);",
            "              aabb.max[1] = Math.max(aabb.max[1], vertex[1]);",
            "            }",
            "          }",
            "        }",
            "        this.object._isUntransformedHitBoxesDirty = false;",
            "    }",
            "}",
            "",
            "gdjs.__sprite3DExtension = {",
            "    Sprite3DRenderer",
            "};",
            ""
          ],
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": true
        }
      ],
      "parameters": [],
      "objectGroups": []
    }
  ],
  "eventsBasedBehaviors": [],
  "eventsBasedObjects": [
    {
      "defaultName": "",
      "description": "",
      "fullName": "3D sprite",
      "is3D": true,
      "isAnimatable": true,
      "name": "Sprite3D",
      "eventsFunctions": [
        {
          "fullName": "",
          "functionType": "Action",
          "name": "onCreated",
          "sentence": "",
          "events": [
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [],
              "actions": [
                {
                  "type": {
                    "value": "Sprite3D::DefineHelperClasses"
                  },
                  "parameters": [
                    "",
                    ""
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::JsCode",
              "inlineCode": [
                "/** @type {gdjs.CustomRuntimeObject} */\r",
                "const object = objects[0];\r",
                "\r",
                "object.__sprite3DExtension = {};\r",
                "object.__sprite3DExtension.sprite3DRenderer = new gdjs.__sprite3DExtension.Sprite3DRenderer(object)\r",
                ""
              ],
              "parameterObjects": "Object",
              "useStrict": true,
              "eventsSheetExpanded": true
            }
          ],
          "parameters": [
            {
              "description": "Object",
              "name": "Object",
              "supplementaryInformation": "Sprite3D::Sprite3D",
              "type": "object"
            }
          ],
          "objectGroups": []
        }
      ],
      "propertyDescriptors": [],
      "objects": [],
      "objectsFolderStructure": {
        "folderName": "__ROOT"
      }
    }
  ]
}