{
  "author": "",
  "category": "General",
  "extensionNamespace": "",
  "fullName": "Bounce Raycasts",
  "helpPath": "",
  "iconUrl": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0ibWRpLXJheS1lbmQiIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMjAsOUMxOC42OSw5IDE3LjU4LDkuODMgMTcuMTcsMTFIMlYxM0gxNy4xN0MxNy41OCwxNC4xNyAxOC42OSwxNSAyMCwxNUEzLDMgMCAwLDAgMjMsMTJBMywzIDAgMCwwIDIwLDlaIiAvPjwvc3ZnPg==",
  "name": "BounceRaycasts",
  "previewIconUrl": "https://asset-resources.gdevelop.io/public-resources/Icons/be2ee69b4454f75eb32ef6a8e73823726c70c2c42002678d128e5eed84cfd720_ray-end.svg",
  "shortDescription": "Allows the user to simulate bouncing raycast.",
  "version": "1.0.0",
  "description": [
    "This extension adds 3 actions:",
    "`Bounce raycasts` - simulates bouncing raycasts with a maximum amount of bounces.",
    "`Bounce and draw raycasts` - simulates bouncing raycasts and immediately draws the bounces using a shape painter object.",
    "`Draw raycast bounces from a variable` - allows the user to draw the bounces from a previously saved simulation using a shape painter object.",
    "",
    "The raycast results are stored in a structure variable.",
    "![Example variable](https://imgur.com/a/N04dQCe)"
  ],
  "tags": [
    "raycast",
    "raycast bouncing",
    "bounces"
  ],
  "authorIds": [
    "2zlLuuwKidTQKeeBwNGHOao4URg1"
  ],
  "dependencies": [],
  "eventsFunctions": [
    {
      "description": "Create a raycast with a set amount of bounces.",
      "fullName": "Bounce raycasts",
      "functionType": "Action",
      "group": "Raycast Bounces",
      "name": "Raycast",
      "sentence": "Cast a ray with a maximum amount of _PARAM6_ bounces, from _PARAM2_;_PARAM3_, angle: _PARAM4_ and max distance _PARAM5_ against _PARAM1_, and save the results in _PARAM7_",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Comment",
          "color": {
            "b": 0,
            "g": 0,
            "r": 0,
            "textB": 255,
            "textG": 255,
            "textR": 255
          },
          "comment": "Resets the values every time the condition is used and saves the start position."
        },
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [
            {
              "type": {
                "value": "ModVarScene"
              },
              "parameters": [
                "__RaycastBounces.StartX",
                "=",
                "GetArgumentAsNumber(\"SourceX\")"
              ]
            },
            {
              "type": {
                "value": "ModVarScene"
              },
              "parameters": [
                "__RaycastBounces.StartY",
                "=",
                "GetArgumentAsNumber(\"SourceY\")"
              ]
            },
            {
              "type": {
                "value": "ModVarScene"
              },
              "parameters": [
                "__RaycastBounces.Angle",
                "=",
                "GetArgumentAsNumber(\"Angle\")"
              ]
            },
            {
              "type": {
                "value": "ModVarScene"
              },
              "parameters": [
                "__RaycastBounces.Index",
                "=",
                "0"
              ]
            },
            {
              "type": {
                "value": "SetSceneVariableAsBoolean"
              },
              "parameters": [
                "__RaycastBounces.StopRaycast",
                "False"
              ]
            },
            {
              "type": {
                "value": "ModVarScene"
              },
              "parameters": [
                "__RaycastBounces.BounceValues.SourceX",
                "=",
                "GetArgumentAsNumber(\"SourceX\")"
              ]
            },
            {
              "type": {
                "value": "ModVarScene"
              },
              "parameters": [
                "__RaycastBounces.BounceValues.SourceY",
                "=",
                "GetArgumentAsNumber(\"SourceY\")"
              ]
            }
          ]
        },
        {
          "folded": true,
          "type": "BuiltinCommonInstructions::Repeat",
          "repeatExpression": "GetArgumentAsNumber(\"Bounces\")+1",
          "conditions": [
            {
              "type": {
                "value": "SceneVariableAsBoolean"
              },
              "parameters": [
                "__RaycastBounces.StopRaycast",
                ""
              ]
            }
          ],
          "actions": [],
          "events": [
            {
              "type": "BuiltinCommonInstructions::Comment",
              "color": {
                "b": 0,
                "g": 0,
                "r": 0,
                "textB": 255,
                "textG": 255,
                "textR": 255
              },
              "comment": "Casts 3 rays, the first one is the main raycast. The other two are used to calculate the collision angle. Thanks Kennoir!"
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "Raycast"
                  },
                  "parameters": [
                    "Against",
                    "Variable(__RaycastBounces.StartX)+Variable(__RaycastBounces.ModifyX)",
                    "Variable(__RaycastBounces.StartY)+Variable(__RaycastBounces.ModifyY)",
                    "Variable(__RaycastBounces.Angle)",
                    "GetArgumentAsNumber(\"MaxDistance\")",
                    "__RaycastBounces.SaveX",
                    "__RaycastBounces.SaveY",
                    ""
                  ]
                },
                {
                  "type": {
                    "value": "Raycast"
                  },
                  "parameters": [
                    "Against",
                    "Variable(__RaycastBounces.StartX)+Variable(__RaycastBounces.ModifyX)",
                    "Variable(__RaycastBounces.StartY)+Variable(__RaycastBounces.ModifyY)",
                    "Variable(__RaycastBounces.Angle)+0.001",
                    "GetArgumentAsNumber(\"MaxDistance\")",
                    "__RaycastBounces.SaveX2",
                    "__RaycastBounces.SaveY2",
                    ""
                  ]
                },
                {
                  "type": {
                    "value": "Raycast"
                  },
                  "parameters": [
                    "Against",
                    "Variable(__RaycastBounces.StartX)+Variable(__RaycastBounces.ModifyX)",
                    "Variable(__RaycastBounces.StartY)+Variable(__RaycastBounces.ModifyY)",
                    "Variable(__RaycastBounces.Angle)-0.001",
                    "GetArgumentAsNumber(\"MaxDistance\")",
                    "__RaycastBounces.SaveX3",
                    "__RaycastBounces.SaveY3",
                    ""
                  ]
                }
              ],
              "actions": []
            },
            {
              "type": "BuiltinCommonInstructions::Comment",
              "color": {
                "b": 0,
                "g": 0,
                "r": 0,
                "textB": 255,
                "textG": 255,
                "textR": 255
              },
              "comment": "Saves the ray collision position."
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [],
              "actions": [
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.BounceValues[Variable(__RaycastBounces.Index)].X",
                    "=",
                    "round(Variable(__RaycastBounces.SaveX))"
                  ]
                },
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.BounceValues[Variable(__RaycastBounces.Index)].Y",
                    "=",
                    "round(Variable(__RaycastBounces.SaveY))"
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Comment",
              "color": {
                "b": 0,
                "g": 0,
                "r": 0,
                "textB": 255,
                "textG": 255,
                "textR": 255
              },
              "comment": "Calculates the collision angle using the 2 additional raycasts. If the collision angle is negative, it adds 360 to make it positive again. It also starts calculating the reflection angle here. At first it's the same as the collision angle."
            },
            {
              "folded": true,
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [],
              "actions": [
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.TargetAngle",
                    "=",
                    "AngleBetweenPositions(Variable(__RaycastBounces.SaveX2), Variable(__RaycastBounces.SaveY2), Variable(__RaycastBounces.SaveX3), Variable(__RaycastBounces.SaveY3))"
                  ]
                }
              ],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [
                    {
                      "type": {
                        "value": "VarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.TargetAngle",
                        "<",
                        "0"
                      ]
                    }
                  ],
                  "actions": [
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.TargetAngle",
                        "+",
                        "360"
                      ]
                    }
                  ]
                },
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [],
                  "actions": [
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.ReflectAngle",
                        "=",
                        "Variable(__RaycastBounces.TargetAngle)-Variable(__RaycastBounces.Angle)"
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "VarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.ReflectAngle",
                    "<",
                    "0"
                  ]
                }
              ],
              "actions": [
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.ReflectAngle",
                    "+",
                    "360"
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Comment",
              "color": {
                "b": 0,
                "g": 0,
                "r": 0,
                "textB": 255,
                "textG": 255,
                "textR": 255
              },
              "comment": "Calculates the normal of the collision. It is moved counter-clockwise or clockwise depending on the start and end values of the raycast."
            },
            {
              "folded": true,
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "BuiltinCommonInstructions::Or"
                  },
                  "parameters": [],
                  "subInstructions": [
                    {
                      "type": {
                        "value": "VarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.StartX",
                        "<",
                        "Variable(__RaycastBounces.SaveX)"
                      ]
                    },
                    {
                      "type": {
                        "value": "VarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.StartY",
                        "<",
                        "Variable(__RaycastBounces.SaveY)"
                      ]
                    }
                  ]
                }
              ],
              "actions": [
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.Normal",
                    "=",
                    "Variable(__RaycastBounces.TargetAngle)-90"
                  ]
                }
              ],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [
                    {
                      "type": {
                        "value": "VarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.Normal",
                        "<",
                        "0"
                      ]
                    }
                  ],
                  "actions": [
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.Normal",
                        "+",
                        "360"
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "folded": true,
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "BuiltinCommonInstructions::Or"
                  },
                  "parameters": [],
                  "subInstructions": [
                    {
                      "type": {
                        "value": "VarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.StartX",
                        ">",
                        "Variable(__RaycastBounces.SaveX)"
                      ]
                    },
                    {
                      "type": {
                        "value": "VarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.StartY",
                        ">",
                        "Variable(__RaycastBounces.SaveY)"
                      ]
                    }
                  ]
                }
              ],
              "actions": [
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.Normal",
                    "=",
                    "Variable(__RaycastBounces.TargetAngle)+90"
                  ]
                },
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.ReflectAngle",
                    "=",
                    "abs(Variable(__RaycastBounces.ReflectAngle)-360)"
                  ]
                }
              ],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [
                    {
                      "type": {
                        "value": "VarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.Normal",
                        ">=",
                        "360"
                      ]
                    }
                  ],
                  "actions": [
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.Normal",
                        "-",
                        "360"
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Comment",
              "color": {
                "b": 0,
                "g": 0,
                "r": 0,
                "textB": 255,
                "textG": 255,
                "textR": 255
              },
              "comment": "The difference between the raycast angle and the normal is the same as the difference between the reflection angle and the normal. Basically, it solves for reflection angle."
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [],
              "actions": [
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.ReflectAngle",
                    "=",
                    "Variable(__RaycastBounces.Normal)+(Variable(__RaycastBounces.Normal)-(Variable(__RaycastBounces.Angle)-180))"
                  ]
                }
              ],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [
                    {
                      "type": {
                        "value": "VarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.ReflectAngle",
                        ">=",
                        "360"
                      ]
                    }
                  ],
                  "actions": [
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.ReflectAngle",
                        "-",
                        "360"
                      ]
                    }
                  ]
                },
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [
                    {
                      "type": {
                        "value": "VarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.ReflectAngle",
                        "<",
                        "0"
                      ]
                    }
                  ],
                  "actions": [
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.ReflectAngle",
                        "+",
                        "360"
                      ]
                    }
                  ]
                },
                {
                  "type": "BuiltinCommonInstructions::Comment",
                  "color": {
                    "b": 0,
                    "g": 0,
                    "r": 0,
                    "textB": 255,
                    "textG": 255,
                    "textR": 255
                  },
                  "comment": "Sets the raycast angle to the reflection angle, sets the start X and Y positions to the last hit positions."
                },
                {
                  "folded": true,
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [],
                  "actions": [
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.Angle",
                        "=",
                        "Variable(__RaycastBounces.ReflectAngle)"
                      ]
                    },
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.StartX",
                        "=",
                        "Variable(__RaycastBounces.SaveX)"
                      ]
                    },
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.StartY",
                        "=",
                        "Variable(__RaycastBounces.SaveY)"
                      ]
                    },
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.BounceValues[Variable(__RaycastBounces.Index)].Angle",
                        "=",
                        "round(Variable(__RaycastBounces.Angle))"
                      ]
                    }
                  ],
                  "events": [
                    {
                      "type": "BuiltinCommonInstructions::Standard",
                      "conditions": [
                        {
                          "type": {
                            "value": "VarScene"
                          },
                          "parameters": [
                            "__RaycastBounces.Index",
                            ">",
                            "0"
                          ]
                        },
                        {
                          "type": {
                            "value": "VarScene"
                          },
                          "parameters": [
                            "__RaycastBounces.BounceValues[Variable(__RaycastBounces.Index)].X",
                            "=",
                            "Variable(__RaycastBounces.BounceValues[Variable(__RaycastBounces.Index)-1].X)"
                          ]
                        },
                        {
                          "type": {
                            "value": "VarScene"
                          },
                          "parameters": [
                            "__RaycastBounces.BounceValues[Variable(__RaycastBounces.Index)].Y",
                            "=",
                            "Variable(__RaycastBounces.BounceValues[Variable(__RaycastBounces.Index)-1].Y)"
                          ]
                        }
                      ],
                      "actions": [
                        {
                          "type": {
                            "value": "ModVarScene"
                          },
                          "parameters": [
                            "__RaycastBounces.BounceValues[Variable(__RaycastBounces.Index)].Angle",
                            "=",
                            "0"
                          ]
                        },
                        {
                          "type": {
                            "value": "SetSceneVariableAsBoolean"
                          },
                          "parameters": [
                            "__RaycastBounces.StopRaycast",
                            "True"
                          ]
                        },
                        {
                          "type": {
                            "value": "VariableRemoveChild"
                          },
                          "parameters": [
                            "__RaycastBounces.BounceValues",
                            "ToString(Variable(__RaycastBounces.Index))"
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Comment",
              "color": {
                "b": 0,
                "g": 0,
                "r": 0,
                "textB": 255,
                "textG": 255,
                "textR": 255
              },
              "comment": "This is to prevent the raycast from getting stuck in the same object it just collided with. For example, if there is an object to the left, the raycast will be offset 1 pixel to the right."
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "CollisionPoint"
                  },
                  "parameters": [
                    "Against",
                    "Variable(__RaycastBounces.StartX)",
                    "Variable(__RaycastBounces.StartY)-1"
                  ]
                }
              ],
              "actions": [
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.ModifyY",
                    "=",
                    "1"
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "CollisionPoint"
                  },
                  "parameters": [
                    "Against",
                    "Variable(__RaycastBounces.StartX)",
                    "Variable(__RaycastBounces.StartY)+1"
                  ]
                }
              ],
              "actions": [
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.ModifyY",
                    "=",
                    "-1"
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "CollisionPoint"
                  },
                  "parameters": [
                    "Against",
                    "Variable(__RaycastBounces.StartX)-1",
                    "Variable(__RaycastBounces.StartY)"
                  ]
                }
              ],
              "actions": [
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.ModifyX",
                    "=",
                    "1"
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "CollisionPoint"
                  },
                  "parameters": [
                    "Against",
                    "Variable(__RaycastBounces.StartX)+1",
                    "Variable(__RaycastBounces.StartY)"
                  ]
                }
              ],
              "actions": [
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.ModifyX",
                    "=",
                    "-1"
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [],
              "actions": [
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.Index",
                    "+",
                    "1"
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "BuiltinCommonInstructions::Comment",
          "color": {
            "b": 0,
            "g": 0,
            "r": 0,
            "textB": 255,
            "textG": 255,
            "textR": 255
          },
          "comment": "Saves the angle and hit X and Y positions of all of the main raycasts to the scene variable specified by the user."
        },
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [
            {
              "type": {
                "value": "CopyVariableToArgument"
              },
              "parameters": [
                "\"VariableName\"",
                "__RaycastBounces.BounceValues"
              ]
            }
          ]
        }
      ],
      "parameters": [
        {
          "description": "Objects to test against the ray",
          "name": "Against",
          "type": "objectList"
        },
        {
          "description": "Ray source X position",
          "name": "SourceX",
          "type": "expression"
        },
        {
          "description": "Ray source Y position",
          "name": "SourceY",
          "type": "expression"
        },
        {
          "description": "Ray angle (in degrees)",
          "name": "Angle",
          "type": "expression"
        },
        {
          "description": "Ray maximum distance (in pixels)",
          "name": "MaxDistance",
          "type": "expression"
        },
        {
          "description": "Max amount of bounces",
          "name": "Bounces",
          "type": "expression"
        },
        {
          "description": "Variable to store the bounce data in",
          "longDescription": "The first hit will be stored at an index of 0, then the next will be stored at an index of 1 and so on. It will only save successful raycasts, which means that the ray needs to hit something for it to save the values. Additionally, it also saves the source X and Y positions of the first ray.",
          "name": "VariableName",
          "type": "scenevar"
        }
      ],
      "objectGroups": []
    },
    {
      "description": "Create a raycast with a set amount of bounces and draw them. Make sure there is a Shape painter object present on the scene.",
      "fullName": "Bounce and draw raycasts",
      "functionType": "Action",
      "group": "Raycast Bounces",
      "name": "DrawRaycast",
      "sentence": "Cast and draw a ray with a maximum amount of _PARAM7_ bounces, from _PARAM3_;_PARAM4_, angle: _PARAM5_ and max distance _PARAM6_ against _PARAM2_, and save the results in _PARAM8_",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Comment",
          "color": {
            "b": 0,
            "g": 0,
            "r": 0,
            "textB": 255,
            "textG": 255,
            "textR": 255
          },
          "comment": "Resets the values every time the condition is used and saves the start position."
        },
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [
            {
              "type": {
                "value": "ModVarScene"
              },
              "parameters": [
                "__RaycastBounces.StartX",
                "=",
                "GetArgumentAsNumber(\"SourceX\")"
              ]
            },
            {
              "type": {
                "value": "ModVarScene"
              },
              "parameters": [
                "__RaycastBounces.StartY",
                "=",
                "GetArgumentAsNumber(\"SourceY\")"
              ]
            },
            {
              "type": {
                "value": "ModVarScene"
              },
              "parameters": [
                "__RaycastBounces.Angle",
                "=",
                "GetArgumentAsNumber(\"Angle\")"
              ]
            },
            {
              "type": {
                "value": "ModVarScene"
              },
              "parameters": [
                "__RaycastBounces.Index",
                "=",
                "0"
              ]
            },
            {
              "type": {
                "value": "SetSceneVariableAsBoolean"
              },
              "parameters": [
                "__RaycastBounces.StopRaycast",
                "False"
              ]
            },
            {
              "type": {
                "value": "ModVarScene"
              },
              "parameters": [
                "__RaycastBounces.BounceValues.SourceX",
                "=",
                "GetArgumentAsNumber(\"SourceX\")"
              ]
            },
            {
              "type": {
                "value": "ModVarScene"
              },
              "parameters": [
                "__RaycastBounces.BounceValues.SourceY",
                "=",
                "GetArgumentAsNumber(\"SourceY\")"
              ]
            }
          ]
        },
        {
          "type": "BuiltinCommonInstructions::Repeat",
          "repeatExpression": "GetArgumentAsNumber(\"Bounces\")+1",
          "conditions": [
            {
              "type": {
                "value": "SceneVariableAsBoolean"
              },
              "parameters": [
                "__RaycastBounces.StopRaycast",
                ""
              ]
            }
          ],
          "actions": [],
          "events": [
            {
              "type": "BuiltinCommonInstructions::Comment",
              "color": {
                "b": 0,
                "g": 0,
                "r": 0,
                "textB": 255,
                "textG": 255,
                "textR": 255
              },
              "comment": "Casts 3 rays, the first one is the main raycast. The other two are used to calculate the collision angle. Thanks Kennoir!"
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "Raycast"
                  },
                  "parameters": [
                    "Against",
                    "Variable(__RaycastBounces.StartX)+Variable(__RaycastBounces.ModifyX)",
                    "Variable(__RaycastBounces.StartY)+Variable(__RaycastBounces.ModifyY)",
                    "Variable(__RaycastBounces.Angle)",
                    "GetArgumentAsNumber(\"MaxDistance\")",
                    "__RaycastBounces.SaveX",
                    "__RaycastBounces.SaveY",
                    ""
                  ]
                },
                {
                  "type": {
                    "value": "Raycast"
                  },
                  "parameters": [
                    "Against",
                    "Variable(__RaycastBounces.StartX)+Variable(__RaycastBounces.ModifyX)",
                    "Variable(__RaycastBounces.StartY)+Variable(__RaycastBounces.ModifyY)",
                    "Variable(__RaycastBounces.Angle)+0.001",
                    "GetArgumentAsNumber(\"MaxDistance\")",
                    "__RaycastBounces.SaveX2",
                    "__RaycastBounces.SaveY2",
                    ""
                  ]
                },
                {
                  "type": {
                    "value": "Raycast"
                  },
                  "parameters": [
                    "Against",
                    "Variable(__RaycastBounces.StartX)+Variable(__RaycastBounces.ModifyX)",
                    "Variable(__RaycastBounces.StartY)+Variable(__RaycastBounces.ModifyY)",
                    "Variable(__RaycastBounces.Angle)-0.001",
                    "GetArgumentAsNumber(\"MaxDistance\")",
                    "__RaycastBounces.SaveX3",
                    "__RaycastBounces.SaveY3",
                    ""
                  ]
                }
              ],
              "actions": []
            },
            {
              "type": "BuiltinCommonInstructions::Comment",
              "color": {
                "b": 0,
                "g": 0,
                "r": 0,
                "textB": 255,
                "textG": 255,
                "textR": 255
              },
              "comment": "Draws the bounces."
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [],
              "actions": [
                {
                  "type": {
                    "value": "PrimitiveDrawing::LineV2"
                  },
                  "parameters": [
                    "ShapePainter",
                    "Variable(__RaycastBounces.StartX)",
                    "Variable(__RaycastBounces.StartY)",
                    "Variable(__RaycastBounces.SaveX)",
                    "Variable(__RaycastBounces.SaveY)",
                    "ShapePainter.OutlineSize()"
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Comment",
              "color": {
                "b": 0,
                "g": 0,
                "r": 0,
                "textB": 255,
                "textG": 255,
                "textR": 255
              },
              "comment": "Saves the ray collision position."
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [],
              "actions": [
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.BounceValues[Variable(__RaycastBounces.Index)].X",
                    "=",
                    "round(Variable(__RaycastBounces.SaveX))"
                  ]
                },
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.BounceValues[Variable(__RaycastBounces.Index)].Y",
                    "=",
                    "round(Variable(__RaycastBounces.SaveY))"
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Comment",
              "color": {
                "b": 0,
                "g": 0,
                "r": 0,
                "textB": 255,
                "textG": 255,
                "textR": 255
              },
              "comment": "Calculates the collision angle using the 2 additional raycasts. If the collision angle is negative, it adds 360 to make it positive again. It also starts calculating the reflection angle here. At first it's the same as the collision angle."
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [],
              "actions": [
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.TargetAngle",
                    "=",
                    "AngleBetweenPositions(Variable(__RaycastBounces.SaveX2), Variable(__RaycastBounces.SaveY2), Variable(__RaycastBounces.SaveX3), Variable(__RaycastBounces.SaveY3))"
                  ]
                }
              ],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [
                    {
                      "type": {
                        "value": "VarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.TargetAngle",
                        "<",
                        "0"
                      ]
                    }
                  ],
                  "actions": [
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.TargetAngle",
                        "+",
                        "360"
                      ]
                    }
                  ]
                },
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [],
                  "actions": [
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.ReflectAngle",
                        "=",
                        "Variable(__RaycastBounces.TargetAngle)-Variable(__RaycastBounces.Angle)"
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "VarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.ReflectAngle",
                    "<",
                    "0"
                  ]
                }
              ],
              "actions": [
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.ReflectAngle",
                    "+",
                    "360"
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Comment",
              "color": {
                "b": 0,
                "g": 0,
                "r": 0,
                "textB": 255,
                "textG": 255,
                "textR": 255
              },
              "comment": "Calculates the normal of the collision. It is moved counter-clockwise or clockwise depending on the start and end values of the raycast."
            },
            {
              "folded": true,
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "BuiltinCommonInstructions::Or"
                  },
                  "parameters": [],
                  "subInstructions": [
                    {
                      "type": {
                        "value": "VarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.StartX",
                        "<",
                        "Variable(__RaycastBounces.SaveX)"
                      ]
                    },
                    {
                      "type": {
                        "value": "VarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.StartY",
                        "<",
                        "Variable(__RaycastBounces.SaveY)"
                      ]
                    }
                  ]
                }
              ],
              "actions": [
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.Normal",
                    "=",
                    "Variable(__RaycastBounces.TargetAngle)-90"
                  ]
                }
              ],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [
                    {
                      "type": {
                        "value": "VarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.Normal",
                        "<",
                        "0"
                      ]
                    }
                  ],
                  "actions": [
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.Normal",
                        "+",
                        "360"
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "folded": true,
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "BuiltinCommonInstructions::Or"
                  },
                  "parameters": [],
                  "subInstructions": [
                    {
                      "type": {
                        "value": "VarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.StartX",
                        ">",
                        "Variable(__RaycastBounces.SaveX)"
                      ]
                    },
                    {
                      "type": {
                        "value": "VarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.StartY",
                        ">",
                        "Variable(__RaycastBounces.SaveY)"
                      ]
                    }
                  ]
                }
              ],
              "actions": [
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.Normal",
                    "=",
                    "Variable(__RaycastBounces.TargetAngle)+90"
                  ]
                },
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.ReflectAngle",
                    "=",
                    "abs(Variable(__RaycastBounces.ReflectAngle)-360)"
                  ]
                }
              ],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [
                    {
                      "type": {
                        "value": "VarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.Normal",
                        ">=",
                        "360"
                      ]
                    }
                  ],
                  "actions": [
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.Normal",
                        "-",
                        "360"
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Comment",
              "color": {
                "b": 0,
                "g": 0,
                "r": 0,
                "textB": 255,
                "textG": 255,
                "textR": 255
              },
              "comment": "The difference between the raycast angle and the normal is the same as the difference between the reflection angle and the normal. Basically, it solves for reflection angle."
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [],
              "actions": [
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.ReflectAngle",
                    "=",
                    "Variable(__RaycastBounces.Normal)+(Variable(__RaycastBounces.Normal)-(Variable(__RaycastBounces.Angle)-180))"
                  ]
                }
              ],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [
                    {
                      "type": {
                        "value": "VarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.ReflectAngle",
                        ">=",
                        "360"
                      ]
                    }
                  ],
                  "actions": [
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.ReflectAngle",
                        "-",
                        "360"
                      ]
                    }
                  ]
                },
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [
                    {
                      "type": {
                        "value": "VarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.ReflectAngle",
                        "<",
                        "0"
                      ]
                    }
                  ],
                  "actions": [
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.ReflectAngle",
                        "+",
                        "360"
                      ]
                    }
                  ]
                },
                {
                  "type": "BuiltinCommonInstructions::Comment",
                  "color": {
                    "b": 0,
                    "g": 0,
                    "r": 0,
                    "textB": 255,
                    "textG": 255,
                    "textR": 255
                  },
                  "comment": "Sets the raycast angle to the reflection angle, sets the start X and Y positions to the last hit positions."
                },
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [],
                  "actions": [
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.Angle",
                        "=",
                        "Variable(__RaycastBounces.ReflectAngle)"
                      ]
                    },
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.StartX",
                        "=",
                        "Variable(__RaycastBounces.SaveX)"
                      ]
                    },
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.StartY",
                        "=",
                        "Variable(__RaycastBounces.SaveY)"
                      ]
                    },
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__RaycastBounces.BounceValues[Variable(__RaycastBounces.Index)].Angle",
                        "=",
                        "round(Variable(__RaycastBounces.Angle))"
                      ]
                    }
                  ],
                  "events": [
                    {
                      "type": "BuiltinCommonInstructions::Standard",
                      "conditions": [
                        {
                          "type": {
                            "value": "VarScene"
                          },
                          "parameters": [
                            "__RaycastBounces.Index",
                            ">",
                            "0"
                          ]
                        },
                        {
                          "type": {
                            "value": "VarScene"
                          },
                          "parameters": [
                            "__RaycastBounces.BounceValues[Variable(__RaycastBounces.Index)].X",
                            "=",
                            "Variable(__RaycastBounces.BounceValues[Variable(__RaycastBounces.Index)-1].X)"
                          ]
                        },
                        {
                          "type": {
                            "value": "VarScene"
                          },
                          "parameters": [
                            "__RaycastBounces.BounceValues[Variable(__RaycastBounces.Index)].Y",
                            "=",
                            "Variable(__RaycastBounces.BounceValues[Variable(__RaycastBounces.Index)-1].Y)"
                          ]
                        }
                      ],
                      "actions": [
                        {
                          "type": {
                            "value": "ModVarScene"
                          },
                          "parameters": [
                            "__RaycastBounces.BounceValues[Variable(__RaycastBounces.Index)].Angle",
                            "=",
                            "0"
                          ]
                        },
                        {
                          "type": {
                            "value": "SetSceneVariableAsBoolean"
                          },
                          "parameters": [
                            "__RaycastBounces.StopRaycast",
                            "True"
                          ]
                        },
                        {
                          "type": {
                            "value": "VariableRemoveChild"
                          },
                          "parameters": [
                            "__RaycastBounces.BounceValues",
                            "ToString(Variable(__RaycastBounces.Index))"
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Comment",
              "color": {
                "b": 0,
                "g": 0,
                "r": 0,
                "textB": 255,
                "textG": 255,
                "textR": 255
              },
              "comment": "This is to prevent the raycast from getting stuck in the same object it just collided with. For example, if there is an object to the left, the raycast will be offset 1 pixel to the right."
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "CollisionPoint"
                  },
                  "parameters": [
                    "Against",
                    "Variable(__RaycastBounces.StartX)",
                    "Variable(__RaycastBounces.StartY)-1"
                  ]
                }
              ],
              "actions": [
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.ModifyY",
                    "=",
                    "1"
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "CollisionPoint"
                  },
                  "parameters": [
                    "Against",
                    "Variable(__RaycastBounces.StartX)",
                    "Variable(__RaycastBounces.StartY)+1"
                  ]
                }
              ],
              "actions": [
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.ModifyY",
                    "=",
                    "-1"
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "CollisionPoint"
                  },
                  "parameters": [
                    "Against",
                    "Variable(__RaycastBounces.StartX)-1",
                    "Variable(__RaycastBounces.StartY)"
                  ]
                }
              ],
              "actions": [
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.ModifyX",
                    "=",
                    "1"
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "CollisionPoint"
                  },
                  "parameters": [
                    "Against",
                    "Variable(__RaycastBounces.StartX)+1",
                    "Variable(__RaycastBounces.StartY)"
                  ]
                }
              ],
              "actions": [
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.ModifyX",
                    "=",
                    "-1"
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [],
              "actions": [
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__RaycastBounces.Index",
                    "+",
                    "1"
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "BuiltinCommonInstructions::Comment",
          "color": {
            "b": 0,
            "g": 0,
            "r": 0,
            "textB": 255,
            "textG": 255,
            "textR": 255
          },
          "comment": "Saves the angle and hit X and Y positions of all of the main raycasts to the scene variable specified by the user."
        },
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [
            {
              "type": {
                "value": "CopyVariableToArgument"
              },
              "parameters": [
                "\"VariableName\"",
                "__RaycastBounces.BounceValues"
              ]
            }
          ]
        }
      ],
      "parameters": [
        {
          "description": "Shape painter object to draw the bounces",
          "name": "ShapePainter",
          "supplementaryInformation": "PrimitiveDrawing::Drawer",
          "type": "objectList"
        },
        {
          "description": "Objects to test against the ray",
          "name": "Against",
          "type": "objectList"
        },
        {
          "description": "Ray source X position",
          "name": "SourceX",
          "type": "expression"
        },
        {
          "description": "Ray source Y position",
          "name": "SourceY",
          "type": "expression"
        },
        {
          "description": "Ray angle (in degrees)",
          "name": "Angle",
          "type": "expression"
        },
        {
          "description": "Ray maximum distance (in pixels)",
          "name": "MaxDistance",
          "type": "expression"
        },
        {
          "description": "Max amount of bounces",
          "name": "Bounces",
          "type": "expression"
        },
        {
          "description": "Variable to store the bounce data in",
          "longDescription": "The first hit will be stored at an index of 0, then the next will be stored at an index of 1 and so on. It will only save successful raycasts, which means that the ray needs to hit something for it to save the values. Additionally, it also saves the source X and Y positions of the first ray.",
          "name": "VariableName",
          "type": "scenevar"
        }
      ],
      "objectGroups": []
    },
    {
      "description": "Draw raycast bounces from a variable containing X and Y positions of the bounces. Make sure there is a Shape painter object present on the scene.",
      "fullName": "Draw raycast bounces from a variable",
      "functionType": "Action",
      "group": "Raycast Bounces",
      "name": "DrawBouncesFromVariable",
      "sentence": "Draw raycast bounces from a variable named _PARAM2_",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Comment",
          "color": {
            "b": 0,
            "g": 0,
            "r": 0,
            "textB": 255,
            "textG": 255,
            "textR": 255
          },
          "comment": "Gets the variable the user has specified and draws the first bounce."
        },
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [
            {
              "type": {
                "value": "CopyArgumentToVariable"
              },
              "parameters": [
                "\"VariableName\"",
                "__RaycastBounces.ExtractedBounces"
              ]
            },
            {
              "type": {
                "value": "ModVarScene"
              },
              "parameters": [
                "__RaycastBounces.Index",
                "=",
                "0"
              ]
            },
            {
              "type": {
                "value": "PrimitiveDrawing::LineV2"
              },
              "parameters": [
                "ShapePainter",
                "Variable(__RaycastBounces.ExtractedBounces.SourceX)",
                "Variable(__RaycastBounces.ExtractedBounces.SourceY)",
                "Variable(__RaycastBounces.ExtractedBounces[0].X)",
                "Variable(__RaycastBounces.ExtractedBounces[0].Y)",
                "ShapePainter.OutlineSize()"
              ]
            }
          ]
        },
        {
          "type": "BuiltinCommonInstructions::Comment",
          "color": {
            "b": 0,
            "g": 0,
            "r": 0,
            "textB": 255,
            "textG": 255,
            "textR": 255
          },
          "comment": "Draws the rest of the bounces."
        },
        {
          "type": "BuiltinCommonInstructions::Repeat",
          "repeatExpression": "VariableChildCount(__RaycastBounces.ExtractedBounces)-3",
          "conditions": [],
          "actions": [
            {
              "type": {
                "value": "PrimitiveDrawing::LineV2"
              },
              "parameters": [
                "ShapePainter",
                "Variable(__RaycastBounces.ExtractedBounces[Variable(__RaycastBounces.Index)].X)",
                "Variable(__RaycastBounces.ExtractedBounces[Variable(__RaycastBounces.Index)].Y)",
                "Variable(__RaycastBounces.ExtractedBounces[Variable(__RaycastBounces.Index)+1].X)",
                "Variable(__RaycastBounces.ExtractedBounces[Variable(__RaycastBounces.Index)+1].Y)",
                "ShapePainter.OutlineSize()"
              ]
            },
            {
              "type": {
                "value": "ModVarScene"
              },
              "parameters": [
                "__RaycastBounces.Index",
                "+",
                "1"
              ]
            }
          ]
        }
      ],
      "parameters": [
        {
          "description": "Shape painter object to draw the bounces",
          "name": "ShapePainter",
          "supplementaryInformation": "PrimitiveDrawing::Drawer",
          "type": "objectList"
        },
        {
          "description": "Structure variable where the bounces are stored",
          "name": "VariableName",
          "type": "scenevar"
        }
      ],
      "objectGroups": []
    }
  ],
  "eventsBasedBehaviors": [],
  "eventsBasedObjects": []
}