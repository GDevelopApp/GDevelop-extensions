{
  "author": "",
  "category": "Network",
  "extensionNamespace": "",
  "fullName": "Authorized Platform Validation",
  "helpPath": "https://oxey405.com/projects/execution-context/index.html",
  "iconUrl": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0ibWRpLWNoZWNrLWRlY2FncmFtIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTIzLDEyTDIwLjU2LDkuMjJMMjAuOSw1LjU0TDE3LjI5LDQuNzJMMTUuNCwxLjU0TDEyLDNMOC42LDEuNTRMNi43MSw0LjcyTDMuMSw1LjUzTDMuNDQsOS4yMUwxLDEyTDMuNDQsMTQuNzhMMy4xLDE4LjQ3TDYuNzEsMTkuMjlMOC42LDIyLjQ3TDEyLDIxTDE1LjQsMjIuNDZMMTcuMjksMTkuMjhMMjAuOSwxOC40NkwyMC41NiwxNC43OEwyMywxMk0xMCwxN0w2LDEzTDcuNDEsMTEuNTlMMTAsMTQuMTdMMTYuNTksNy41OEwxOCw5TDEwLDE3WiIgLz48L3N2Zz4=",
  "name": "AuthorizedPlatformsValidation",
  "previewIconUrl": "https://asset-resources.gdevelop.io/public-resources/Icons/0d42bc9711bc135b0dfb0084a37469540468e243a560339b99e399bd77f48010_check-decagram.svg",
  "shortDescription": "Checks if the game is currently executed on an allowed platform (for web)",
  "version": "1.0.7",
  "description": [
    "**check if your web game is being played on a platform your intended to publish on**",
    "Some web game platforms may steal your game to publish it on their own without your knowledge or consent!",
    "This extension is here to check if the game is being played on an authorized platform you can set!",
    "",
    "*How to use*",
    "an authorized platform is a domain name of a website where the game is supposed to run, for example : gd.games.",
    "1. You can get the current domain where the game is being played by using getReferrer()",
    "2. You can add an authorized platform domain name (it's recommended to do this at the beginning of the scene)",
    "3. You can then check if the game is running on an authorized platform and make the game react accordingly"
  ],
  "tags": [
    "DRM",
    "Copyright",
    "Origin",
    "Referrer",
    "Execution Context",
    "Platform"
  ],
  "authorIds": [
    "Mk7N5tFrpcePEmbe3ZLC4peEULY2"
  ],
  "dependencies": [],
  "eventsFunctions": [
    {
      "description": "Checks if the game is executed on an authorized platform",
      "fullName": "Is the game running on an authorized platform",
      "functionType": "Condition",
      "name": "CheckExecution",
      "sentence": "The game is running on a authorized platform",
      "events": [
        {
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": [
            "let currentReferrer = \"\";\r",
            "try {\r",
            "    currentReferrer = new URL(document.referrer).hostname;\r",
            "\r",
            "} catch(err) {\r",
            "    //We generally do not care about an error while parsing the URL\r",
            "    console.log(\"Game is not running on a web platform\")\r",
            "}\r",
            "eventsFunctionContext.returnValue = gdjs._authorizedPlatforms.validPlatforms.includes(currentReferrer.hostname);"
          ],
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": false
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Get the referrer's location aka the domain of the page (at the root)",
      "fullName": "Get referrer location",
      "functionType": "StringExpression",
      "name": "CurrentRefferer",
      "sentence": "",
      "events": [
        {
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": [
            "let location = \"\";\r",
            "try {\r",
            "    location = new URL(document.referrer).hostname\r",
            "} catch(err) {\r",
            "    //If we could not parse the referrer into an URL, it means we are running locally\r",
            "}\r",
            "eventsFunctionContext.returnValue = location;"
          ],
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": false
        }
      ],
      "expressionType": {
        "type": "string"
      },
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Adds a new valid platform aka a domain name where the game is expected to be played (e.g : gd.games)",
      "fullName": "Add a valid platform",
      "functionType": "Action",
      "name": "AddExecution",
      "sentence": "Add _PARAM1_ as valid platform",
      "events": [
        {
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "gdjs._authorizedPlatforms.validPlatforms.push(eventsFunctionContext.getArgument(\"domain\"));",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": false
        }
      ],
      "parameters": [
        {
          "description": "Domain name (e.g : gd.games)",
          "name": "domain",
          "type": "string"
        }
      ],
      "objectGroups": []
    },
    {
      "fullName": "",
      "functionType": "Action",
      "name": "onFirstSceneLoaded",
      "sentence": "",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": []
        },
        {
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "gdjs._authorizedPlatforms = {validPlatforms: [\"\"]}",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": false
        }
      ],
      "parameters": [],
      "objectGroups": []
    }
  ],
  "eventsBasedBehaviors": [],
  "eventsBasedObjects": []
}