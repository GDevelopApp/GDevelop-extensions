{
  "author": "",
  "category": "",
  "description": "Adds events to record the game and let players download the clips. Includes options to pause, and resume recordings. Additonally, frame rate, and file format can be picked.",
  "extensionNamespace": "",
  "fullName": "Record",
  "helpPath": "",
  "iconUrl": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0ibWRpLXZpZGVvLXZpbnRhZ2UiIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTgsMTQuNVYxMUExLDEgMCAwLDAgMTcsMTBIMTZDMTguMjQsOC4zOSAxOC43Niw1LjI3IDE3LjE1LDNDMTUuNTQsMC43OCAxMi40MiwwLjI2IDEwLjE3LDEuODdDOS41LDIuMzUgOC45NiwzIDguNiwzLjczQzYuMjUsMi4yOCAzLjE3LDMgMS43Miw1LjM3QzAuMjgsNy43MiAxLDEwLjggMy4zNiwxMi4yNUMzLjU3LDEyLjM3IDMuNzgsMTIuNSA0LDEyLjU4VjIxQTEsMSAwIDAsMCA1LDIySDE3QTEsMSAwIDAsMCAxOCwyMVYxNy41TDIyLDIxLjVWMTAuNUwxOCwxNC41TTEzLDRBMiwyIDAgMCwxIDE1LDZBMiwyIDAgMCwxIDEzLDhBMiwyIDAgMCwxIDExLDZBMiwyIDAgMCwxIDEzLDRNNiw2QTIsMiAwIDAsMSA4LDhBMiwyIDAgMCwxIDYsMTBBMiwyIDAgMCwxIDQsOEEyLDIgMCAwLDEgNiw2WiIgLz48L3N2Zz4=",
  "name": "Record",
  "previewIconUrl": "https://resources.gdevelop-app.com/assets/Icons/video-vintage.svg",
  "shortDescription": "Adds events to record the game and players download the clips. Works on desktop, and Chrome based browsers.",
  "version": "1.0.0",
  "tags": [
    "DOM apis",
    "Record",
    "Capture",
    "Video"
  ],
  "authorIds": [
    "AlZ3D1xkH0QDao7T37VZZUeYNpn1"
  ],
  "dependencies": [],
  "eventsFunctions": [
    {
      "description": "",
      "fullName": "",
      "functionType": "Action",
      "group": "",
      "name": "onFirstSceneLoaded",
      "private": false,
      "sentence": "",
      "events": [
        {
          "disabled": false,
          "folded": false,
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "gdjs._extensionRecord = {\r\n  mediaRecorder: null,\r\n  // Default settings for recording\r\n  options: {\r\n    videoBitsPerSecond: 2500000,\r\n    // audioBitsPerSecond: 128000,\r\n    format: 'mp4',\r\n  },\r\n  handler: {\r\n    resume: false,\r\n    error: false,\r\n    pause: false,\r\n    start: false,\r\n    stop: false,\r\n    save: false,\r\n  },\r\n  canvas: null,\r\n  blob: null,\r\n  fps: 30,\r\n}\r\n\r\nconsole.log(gdjs._extensionRecord.format);\r\n\r\n// Return enverioment type\r\ngdjs._extensionRecord.environmentType = function() {\r\n    // Check if the environment is Node\r\n    if (typeof process === \"object\" && typeof require === \"function\") {\r\n        return 'desktop';\r\n    }\r\n\r\n    // Check if the environment is a Browser\r\n    if (typeof window === \"object\") {\r\n        return 'web';\r\n    }\r\n\r\n    // Check if the environment is Mobile\r\n    if (gdjs.evtTools.systemInfo.isMobile()) {\r\n        return 'mobile';\r\n    }\r\n}\r\n\r\n// Return Node filesystem if it exists\r\ngdjs._extensionRecord.fs = function() {\r\n    const electron = runtimeScene.getGame().getRenderer().getElectron();\r\n    if(!electron) return;\r\n    return electron.remote.require(\"fs\");\r\n}\r\n\r\n// Return true if format is supported false otherwise\r\ngdjs._extensionRecord.isFormatSupported = function(format) {    \r\n    format = format.toLowerCase();\r\n\r\n    return MediaRecorder.isTypeSupported('video/' + format);\r\n}\r\n",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": true
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Start the recording",
      "fullName": "Start recording",
      "functionType": "Action",
      "group": "",
      "name": "Start",
      "private": false,
      "sentence": "Start recording",
      "events": [
        {
          "disabled": false,
          "folded": false,
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "const recorder = gdjs._extensionRecord;\r\nrecorder.canvas = document.querySelector('canvas');\r\n\r\nconst stream = recorder.canvas.captureStream(recorder.fps);\r\n\r\n// Buffer for recorded chunks\r\nlet recordedChunks = [];\r\n\r\nrecorder.mediaRecorder = new MediaRecorder(stream, recorder.options);\r\n\r\nrecorder.mediaRecorder.ondataavailable = handleDataAvailable;\r\nrecorder.mediaRecorder.start();\r\nrecorder.mediaRecorder.onstop = () => blobify();\r\n\r\n// console.log(recorder);\r\n\r\n// Add chunk to the array\r\nfunction handleDataAvailable(event) {\r\n  if (event.data.size > 0) {\r\n    recordedChunks.push(event.data);\r\n  }\r\n}\r\n\r\n// Converts the array into a blob of the correct type\r\nfunction blobify() {\r\n  recorder.blob = new Blob(recordedChunks, {\r\n    type: 'video/' + recorder.options.format,\r\n  });\r\n}",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": true
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "End the recording",
      "fullName": "Stop recording",
      "functionType": "Action",
      "group": "",
      "name": "Stop",
      "private": false,
      "sentence": "Stop the recording",
      "events": [
        {
          "disabled": false,
          "folded": false,
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "gdjs._extensionRecord.mediaRecorder.stop();",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": true
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Pause recording",
      "fullName": "Pause recording",
      "functionType": "Action",
      "group": "",
      "name": "Pause",
      "private": false,
      "sentence": "Pause recording",
      "events": [
        {
          "disabled": false,
          "folded": false,
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "gdjs._extensionRecord.mediaRecorder.pause();",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": true
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Resume recording",
      "fullName": "Resume recording",
      "functionType": "Action",
      "group": "",
      "name": "Resume",
      "private": false,
      "sentence": "Resume recording",
      "events": [
        {
          "disabled": false,
          "folded": false,
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "gdjs._extensionRecord.mediaRecorder.resume();",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": true
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Save recording to the file system on destop, or to the downloads folder for web. Always ask for permission to save a file.",
      "fullName": "Save recording",
      "functionType": "Action",
      "group": "",
      "name": "Save",
      "private": false,
      "sentence": "Save recording to _PARAM1_ as _PARAM2_",
      "events": [
        {
          "disabled": false,
          "folded": false,
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "const recorder = gdjs._extensionRecord;\r\nconst path = eventsFunctionContext.getArgument('path');\r\nconst name = eventsFunctionContext.getArgument('name');\r\n\r\n// console.log(recorder);\r\n\r\nswitch (recorder.environmentType()) {\r\n    case 'desktop':\r\n        desktopDownload();\r\n    break;\r\n\r\n    case 'web':\r\n        webDownload();\r\n    break;\r\n\r\n    // TODO \r\n    case 'mobile':\r\n    break;\r\n}\r\n\r\nasync function desktopDownload() {\r\n    const buffer = Buffer.from(await recorder.blob.arrayBuffer());\r\n\r\n    const unixPath = path.replace(/\\\\/g, \"/\");\r\n\r\n    recorder.fs().writeFile(path + '\\\\' + name + '.' + recorder.options.format, buffer, () => recorder.handler.save = true);\r\n}\r\n\r\nconsole.log(name + '.' + recorder.options.format);\r\n\r\n// Replace with File System Access API when support is more widespread\r\nasync function webDownload() {\r\n        const href = URL.createObjectURL(recorder.blob);\r\n\r\n        console.log(href);\r\n\r\n        const ref = window.open(href, name);\r\n\r\n        ref.onbeforeunload = () => URL.revokeObjectURL(href);\r\n}",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": true
        }
      ],
      "parameters": [
        {
          "codeOnly": false,
          "defaultValue": "",
          "description": "File location is only used for desktop saves",
          "longDescription": "",
          "name": "path",
          "optional": false,
          "supplementaryInformation": "",
          "type": "string"
        },
        {
          "codeOnly": false,
          "defaultValue": "",
          "description": "Name of video",
          "longDescription": "",
          "name": "name",
          "optional": false,
          "supplementaryInformation": "",
          "type": "string"
        }
      ],
      "objectGroups": []
    },
    {
      "description": "Returns the current state of the reccorder: inactive (not recording), recording, and paused",
      "fullName": "Get current state",
      "functionType": "StringExpression",
      "group": "",
      "name": "State",
      "private": false,
      "sentence": "",
      "events": [
        {
          "disabled": false,
          "folded": false,
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "eventsFunctionContext.returnValue = gdjs._extensionRecord.mediaRecorder.state;\r\n",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": false
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Get the current framerate",
      "fullName": "Get frame rate",
      "functionType": "Expression",
      "group": "Record/Options",
      "name": "FrameRate",
      "private": false,
      "sentence": "Set frame rate to _PARAM1_",
      "events": [
        {
          "disabled": false,
          "folded": false,
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "eventsFunctionContext.returnValue = gdjs._extensionRecord.fps;\r\n",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": false
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Set the frame rate, must be set before starting a recording. Defaults to 30 fps if not set.",
      "fullName": "Set frame rate",
      "functionType": "Action",
      "group": "Record/Options",
      "name": "SetFrameRate",
      "private": false,
      "sentence": "Set frame rate to _PARAM1_",
      "events": [
        {
          "disabled": false,
          "folded": false,
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "gdjs._extensionRecord.fps = eventsFunctionContext.getArgument('fps');",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": true
        }
      ],
      "parameters": [
        {
          "codeOnly": false,
          "defaultValue": "",
          "description": "Recommended fps: 25, 30, 60, or 120",
          "longDescription": "",
          "name": "fps",
          "optional": false,
          "supplementaryInformation": "",
          "type": "expression"
        }
      ],
      "objectGroups": []
    },
    {
      "description": "Returns the video bit rate per second",
      "fullName": "Get video bit rate per second",
      "functionType": "Expression",
      "group": "Record/Options",
      "name": "VideoBitRate",
      "private": false,
      "sentence": "",
      "events": [
        {
          "disabled": false,
          "folded": false,
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "eventsFunctionContext.returnValue = gdjs._extensionRecord.mediaRecorder.videoBitsPerSecond;\r\n",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": false
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Returns the video bit rate per second.  Defaults to 2500000 if not set.",
      "fullName": "Set video bit rate",
      "functionType": "Action",
      "group": "Record/Options",
      "name": "SetVideoBitRate",
      "private": false,
      "sentence": "Set the video bit rate to _PARAM1_",
      "events": [
        {
          "disabled": false,
          "folded": false,
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "eventsFunctionContext.returnValue = gdjs._extensionRecord.mediaRecorder.videoBitsPerSecond;\r\n",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": false
        }
      ],
      "parameters": [
        {
          "codeOnly": false,
          "defaultValue": "",
          "description": "video bits per second",
          "longDescription": "",
          "name": "rate",
          "optional": false,
          "supplementaryInformation": "",
          "type": "expression"
        }
      ],
      "objectGroups": []
    },
    {
      "description": "Returns the audio bit rate per second.  Defaults to 128000 if not set.",
      "fullName": "Set audio bit rate",
      "functionType": "Action",
      "group": "Record/Options",
      "name": "SetAudioBitRate",
      "private": true,
      "sentence": "Set the audio bit rate to _PARAM1_",
      "events": [
        {
          "disabled": false,
          "folded": false,
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "// Audio recording doesn't work. This function exsits for when it does.\r\neventsFunctionContext.returnValue = gdjs._extensionRecord.mediaRecorder.audioBitsPerSecond;",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": false
        }
      ],
      "parameters": [
        {
          "codeOnly": false,
          "defaultValue": "",
          "description": "video Bits Per second",
          "longDescription": "",
          "name": "rate",
          "optional": false,
          "supplementaryInformation": "",
          "type": "expression"
        }
      ],
      "objectGroups": []
    },
    {
      "description": "Returns the audio bit rate per second",
      "fullName": "Get audio bit rate per second",
      "functionType": "Expression",
      "group": "Record/Options",
      "name": "AudioBitRate",
      "private": true,
      "sentence": "",
      "events": [
        {
          "disabled": false,
          "folded": false,
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "// Audio recording doesn't work. This function exsits for when it does.\r\neventsFunctionContext.returnValue = gdjs._extensionRecord.mediaRecorder.audioBitsPerSecond;",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": false
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Set the file format, if a selected file format is unsupported on the users platform a supported one will be picked by deafult",
      "fullName": "Set file format",
      "functionType": "Action",
      "group": "Record/Options",
      "name": "SetFormat",
      "private": false,
      "sentence": "Set file format to _PARAM1_",
      "events": [
        {
          "disabled": false,
          "folded": false,
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "const format = eventsFunctionContext.getArgument('format');\r\nconst supported = gdjs._extensionRecord.isFormatSupported(format);\r\n\r\nif (supported === true) gdjs._extensionRecord.options.format = format;\r\nelse gdjs._extensionRecord.format = 'mp4';",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": true
        }
      ],
      "parameters": [
        {
          "codeOnly": false,
          "defaultValue": "",
          "description": "Recording format",
          "longDescription": "",
          "name": "format",
          "optional": false,
          "supplementaryInformation": "[\"webm\",\"mp4\",\"ogg\"]",
          "type": "stringWithSelector"
        }
      ],
      "objectGroups": []
    },
    {
      "description": "Returns the current video format",
      "fullName": "Get video format",
      "functionType": "Expression",
      "group": "Record/Options",
      "name": "Format",
      "private": false,
      "sentence": "",
      "events": [
        {
          "disabled": false,
          "folded": false,
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "eventsFunctionContext.returnValue = gdjs._extensionRecord.mediaRecorder.videoBitsPerSecond;\r\n",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": false
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "On error",
      "fullName": "When an errror has occurred ",
      "functionType": "Condition",
      "group": "",
      "name": "OnError",
      "private": true,
      "sentence": "On error",
      "events": [
        {
          "disabled": false,
          "folded": false,
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "// Web support is not consistent enough to include. Use only in desktop and mobile envroments.\ngdjs._extensionRecord.mediaRecorder.onerror = function() {\n    gdjs._extensionRecord.handler.error = true;\n}\n\neventsFunctionContext.returnValue = gdjs._extensionRecord.handler.error;\ngdjs._extensionRecord.handler.error = false;",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": true
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "When an error occurs this method will return what type of error it is",
      "fullName": "Error type",
      "functionType": "StringExpression",
      "group": "",
      "name": "ErrorType",
      "private": true,
      "sentence": "",
      "events": [
        {
          "disabled": false,
          "folded": false,
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "// Web support is not consistent enough to include. Use only in desktop and mobile envroments.\r\ngdjs._extensionRecord.mediaRecorder.onerror = function(event) {\r\n    eventsFunctionContext.returnValue(event.error.name);\r\n}",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": true
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Check if a recording has just been paused",
      "fullName": "When recording has paused",
      "functionType": "Condition",
      "group": "Record/Events",
      "name": "OnPause",
      "private": false,
      "sentence": "When recording has paused",
      "events": [
        {
          "disabled": false,
          "folded": false,
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "gdjs._extensionRecord.mediaRecorder.onpause = function() {\r\n    gdjs._extensionRecord.handler.pause = true;\r\n}\r\n\r\neventsFunctionContext.returnValue = gdjs._extensionRecord.handler.pause;\r\ngdjs._extensionRecord.handler.pause = false;",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": true
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Check if a recording has just been resumed",
      "fullName": "When recording has resumed",
      "functionType": "Condition",
      "group": "Record/Events",
      "name": "OnResume",
      "private": false,
      "sentence": "When recording has resumed",
      "events": [
        {
          "disabled": false,
          "folded": false,
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "gdjs._extensionRecord.mediaRecorder.onresume = function() {\r\n    gdjs._extensionRecord.handler.resume = true;\r\n}\r\n\r\neventsFunctionContext.returnValue = gdjs._extensionRecord.handler.resume;\r\ngdjs._extensionRecord.handler.resume = false;",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": true
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Check if recording has just started",
      "fullName": "When recording has started",
      "functionType": "Condition",
      "group": "Record/Events",
      "name": "OnStart",
      "private": false,
      "sentence": "When recording has started",
      "events": [
        {
          "disabled": false,
          "folded": false,
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "gdjs._extensionRecord.mediaRecorder.onstart = function() {\r\n    gdjs._extensionRecord.handler.start = true;\r\n}\r\n\r\neventsFunctionContext.returnValue = gdjs._extensionRecord.handler.start;\r\ngdjs._extensionRecord.handler.start = false;",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": true
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Check if recording has just stopped",
      "fullName": "When recording has stopped",
      "functionType": "Condition",
      "group": "Record/Events",
      "name": "OnStop",
      "private": false,
      "sentence": "When recording has stopped",
      "events": [
        {
          "disabled": false,
          "folded": false,
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "gdjs._extensionRecord.mediaRecorder.onstop = function() {\r\n    gdjs._extensionRecord.handler.stop = true;\r\n}\r\n\r\neventsFunctionContext.returnValue = gdjs._extensionRecord.handler.stop;\r\ngdjs._extensionRecord.handler.stop = false;",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": true
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Check if recording has just been saved",
      "fullName": "When recording has saved",
      "functionType": "Condition",
      "group": "Record/Events",
      "name": "OnSave",
      "private": false,
      "sentence": "When recording has been saved",
      "events": [
        {
          "disabled": false,
          "folded": false,
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "eventsFunctionContext.returnValue = gdjs._extensionRecord.handler.save;\r\ngdjs._extensionRecord.handler.save = false;",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": true
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Check if the specified format is available on the users device. To avoid unsupported formats pick commons ones like MP4 or WebM.",
      "fullName": "Is format supported on user device",
      "functionType": "Condition",
      "group": "",
      "name": "IsFormatSupported",
      "private": false,
      "sentence": "Check if _PARAM1_ is available on the users device",
      "events": [
        {
          "disabled": false,
          "folded": false,
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "const format = eventsFunctionContext.getArgument('format');\r\n\r\neventsFunctionContext.returnValue = gdjs._extensionRecord.isFormatSupported(format);",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": true
        }
      ],
      "parameters": [
        {
          "codeOnly": false,
          "defaultValue": "",
          "description": "Select a common format for the best results",
          "longDescription": "",
          "name": "format",
          "optional": false,
          "supplementaryInformation": "[\"WebM\",\"MP4\",\"3GP\",\"Ogg\"]",
          "type": "stringWithSelector"
        }
      ],
      "objectGroups": []
    }
  ],
  "eventsBasedBehaviors": []
}